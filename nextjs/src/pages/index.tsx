import React, { useEffect } from "react"
import Head from "next/head"
import CameraPicker from "./components/cameraPicker"
import CctvCamera from "./components/cctvCamera"
import LockInPoints from "./components/LockInPoints"
import Map from "./components/map"

import useIntersectionStore from "~/pages/hooks/IntersectionStore"

export default function Home() {
  const setCamera = useIntersectionStore((state) => state.setCamera)
  const camera = useIntersectionStore((state) => state.camera)

  // Load the camera from localStorage when the component mounts
  useEffect(() => {
    const storedCamera = localStorage.getItem("camera")
    if (storedCamera) {
      setCamera(JSON.parse(storedCamera) as number)
    }
  }, [])

  // Save the camera to localStorage whenever it changes
  useEffect(() => {
    localStorage.setItem("camera", JSON.stringify(camera))
  }, [camera])

  return (
    <>
      <Head>
        <title>Traffic Volume Estimator</title>
        <meta name="description" content="Generated by create-t3-app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <main className="flex h-screen flex-col">
        <div className="flex h-10 w-full items-center justify-center">
          <CameraPicker />
          <LockInPoints />
        </div>
        <div className="flex flex-grow">
          <div className="h-full w-1/2 border-r">
            <CctvCamera />
          </div>
          <div className="h-full w-1/2">
            <Map />
          </div>
        </div>
      </main>
    </>
  )
}
